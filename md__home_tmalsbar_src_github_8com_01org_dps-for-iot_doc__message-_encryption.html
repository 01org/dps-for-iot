<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Distributed Publish Subscribe for IoT: Message Encryption</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Distributed Publish Subscribe for IoT
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('md__home_tmalsbar_src_github_8com_01org_dps-for-iot_doc__message-_encryption.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Message Encryption </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The following assumes you are already familiar with the <a class="el" href="_message-_protocol_8md.html">DPS message protocol</a>.</p>
<p>DPS messages are encrypted using <a href="https://tools.ietf.org/html/rfc8152">COSE</a>.</p>
<p>Keys are provided to DPS via the <a class="el" href="group__keystore.html">Key Store</a>.</p>
<h2>Content Encryption</h2>
<p>The <em>protected</em> section of a DPS message forms the protected attributes from the application as identified in COSE. The <em>encrypted</em> section of a DPS message is the plaintext provided to the content encryption algorithm and is replaced by a COSE object, either a <em>COSE_Encrypt_Tagged</em> or <em>COSE_Encrypt0_Tagged</em> object.</p>
<p>The implemented content encryption algorithms are <em>AES-CCM-16-128-128</em> and <em>AES-CCM-16-64-128</em>.</p>
<h2>Content Key Distribution</h2>
<p>The encryption key is determined by the recipient algorithm. DPS supports the <em>direct</em>, <em>A128KW</em>, <em>ECDH-ES + HKDF-256</em>, and <em>ECDH-ES + A128KW</em> recipient algorithms.</p>
<p>The use of the key wrap variants allows multiple recipients to be included in a message.</p>
<h3>Elliptic Curve Keys</h3>
<p>DPS supports the <em>NIST P-256 (secp256r1)</em>, <em>NIST P-384 (secp384r1)</em>, and <em>NIST P-521 (secp521r1)</em> curves.</p>
<p>Point compression is not supported. Both the x and y coordinates must be included in EC key representations such as the ephemeral sender key.</p>
<h3>Key Derivation Functions</h3>
<p>HKDF requires context information to be provided. This is represented in COSE as the <em>COSE_KDF_Context</em>.</p>
<p>The values of the <em>identity</em>, <em>nonce</em>, and <em>other</em> fields of the <em>PartyUInfo</em> and <em>PartyVInfo</em> structures in the <em>COSE_KDF_Context</em> are <em>nil</em>.</p>
<p><em>SuppPrivInfo</em> is not included in the <em>COSE_KDF_Context</em>.</p>
<h2>Counter Signatures</h2>
<p>After encryption, the encrypted content is signed by the sender and the signature is included as a COSE counter signature. This allows intermediate DPS nodes to authenticate the sender of a message without decrypting the contents of the message.</p>
<p>DPS supports the <em>ES256</em>, <em>ES384</em>, and <em>ES512</em> signature algorithms.</p>
<h2>Examples</h2>
<p>An example encrypted publication message, using <em>AES-CCM-16-128-128</em> for the content, <em>ECDH-ES+A128KW</em> for the key distribution, and <em>ES256</em> for signing, will look like:</p>
<div class="fragment"><div class="line">message = [</div><div class="line">  / version / 1,</div><div class="line">  / type / 1,</div><div class="line">  /unprotected / {</div><div class="line">    / port / 1: 42446,</div><div class="line">    / ttl / 2: 0</div><div class="line">  },</div><div class="line">  / protected (aad) / {</div><div class="line">    / ttl / 2: 0,</div><div class="line">    / pub-id / 3: h&#39;17003AE54085EE56F735764C7631CE61&#39;,</div><div class="line">    / seq-num / 4: 1,</div><div class="line">    / ack-req / 5: false,</div><div class="line">    / bloom-filter / 6: [1, 8192, h&#39;002817805F00982A&#39;]</div><div class="line">  },</div><div class="line">  / encrypted (COSE_Encrypt_Tagged) / 96(</div><div class="line">    [</div><div class="line">      / protected / h&#39;A101181E&#39; / {</div><div class="line">          \ alg \ 1: 30 \ AES-CCM-16-128-128 \</div><div class="line">        } /,</div><div class="line">      / unprotected / {</div><div class="line">        / iv / 5: h&#39;0100000017003AE54085EE56F7&#39;,</div><div class="line">        / countersign / 7: [</div><div class="line">          / protected / h&#39;A10126&#39; /</div><div class="line">              \ alg \ 1: -7 \ ECDSA 256 \</div><div class="line">            } /,</div><div class="line">          / unprotected / {</div><div class="line">            / kid / 4: h&#39;4450532054657374205075626C6973686572&#39;</div><div class="line">          },</div><div class="line">          / signature / h&#39;1F14BDB559BB24A50B1C1ECA91938C445CFF64C4A24F075A6105B4679D19AEE439413AD30BE4C6C402031B2B04E7D6C2E4B2BA6A4C788E5C7DDE805654CA38CE&#39;</div><div class="line">        ]</div><div class="line">      },</div><div class="line">      / ciphertext / h&#39;457C20BF6EB818AD98C4D820EFD2B017CACE97C47144E3D6&#39;,</div><div class="line">      / recipients / [</div><div class="line">        [</div><div class="line">          / protected / h&#39;A101381C&#39; / {</div><div class="line">              \ alg \ 1: -29 \ ECDH-ES+A128KW \</div><div class="line">            } /,</div><div class="line">          / unprotected / {</div><div class="line">            / ephemeral / -1: {</div><div class="line">              / kty / 1: 2,</div><div class="line">              / crv / -1: 1,</div><div class="line">              / x / -2: h&#39;B34D696D855245BB79FCC8F0A328F37B7CC935803DAEC9EBAB97F061A68444E1&#39;,</div><div class="line">              / y / -3: h&#39;CDF27464CDC3A65DA7EC37139C354940E219A5E55D1A28265A015B2D0A47F72F&#39;</div><div class="line">            },</div><div class="line">            / kid / 4: h&#39;44505320546573742053756273637269626572&#39;</div><div class="line">          },</div><div class="line">          / ciphertext / h&#39;CF83EEA4B372FC210A374E44F040EEFA345C569C2D74A322&#39;</div><div class="line">        ]</div><div class="line">      ]</div><div class="line">    ]</div><div class="line">  )</div><div class="line">]</div></div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<div class="navpath" id="nav-path">
  <ul>
    <li class="footer" style="float:left"><b>Distributed PubSub Manual</b></li> <li class="footer">Generated Tue Feb 20 2018 10:23:49</li>
  </ul>
</div>
</body>
</html>
