<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.14">
  <compounddef id="tutorials-link" kind="page">
    <compoundname>tutorials-link</compoundname>
    <title>Building a DPS network</title>
    <tableofcontents/>
    <briefdescription>
<para><linebreak/>
 </para>    </briefdescription>
    <detaileddescription>
<para><linebreak/>
</para><para>The <ref refid="tutorials-hello-world" kindref="compound">Hello world</ref> tutorial showed how to build a simple multicast publisher and subscriber network. This tutorial will show how to use the link functionality of DPS to create more complex networks that can span subnets.</para><para>As before, we need to create nodes for the publisher and subscriber using <ref refid="tutorials-hello-world_1creating-a-node" kindref="member">DPS_CreateNode() </ref>. But this time we will create a third type of node that is neither a publisher or subscriber that will forward publications and subscriptions between the publisher and subscriber nodes.</para><para>Note that a third node is not strictly necessary. It is possible to use the same mechanisms described below to link the publisher and subscriber nodes.</para><sect1 id="tutorials-link_1starting-a-unicast-node">
<title>Starting a node</title>
<para><programlisting filename="tutorial.c"><codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>mcastPub<sp/>=<sp/><ref refid="group__node_1gac939c83361ed89086f37c78d9c9009dd" kindref="member">DPS_MCAST_PUB_DISABLED</ref>;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="group__nodeaddress_1ga9e9f56aa38e82b4edcef7eb81e9f5bd2" kindref="member">DPS_NodeAddress</ref>*<sp/>listenAddr<sp/>=<sp/><ref refid="group__nodeaddress_1ga8c6228133cac7601597f3c6160de5aab" kindref="member">DPS_CreateAddress</ref>();</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!listenAddr)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/><ref refid="group__status_1ga09dd06b53fdfdc87406d380de331b75b" kindref="member">DPS_ERR_RESOURCES</ref>;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>Exit;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>snprintf(addrText,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(addrText),<sp/></highlight><highlight class="stringliteral">&quot;[::]:%d&quot;</highlight><highlight class="normal">,<sp/>port);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="group__nodeaddress_1ga1492aff0a8789c4b8a7cc47c84ca1b1f" kindref="member">DPS_SetAddress</ref>(listenAddr,<sp/>addrText);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>ret<sp/>=<sp/><ref refid="group__node_1ga538588a1e2ea805377a90ac22ee6bc82" kindref="member">DPS_StartNode</ref>(node,<sp/>mcastPub,<sp/>listenAddr);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>!=<sp/><ref refid="group__status_1ga0ea3dd37bc558859ae0cb5a4f79a4bdd" kindref="member">DPS_OK</ref>)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>Exit;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
</programlisting> The first thing we will do is disable multicast sending and receiving for our three nodes by using <ref refid="group__node_1gac939c83361ed89086f37c78d9c9009dd" kindref="member">DPS_MCAST_PUB_DISABLED</ref> for the <computeroutput>mcastPub</computeroutput> parameter of <ref refid="group__node_1ga538588a1e2ea805377a90ac22ee6bc82" kindref="member">DPS_StartNode()</ref>. All publications and subscriptions will go through the forwarding node.</para><para>The second thing we do is specify the <computeroutput>listenAddr</computeroutput> parameter to <ref refid="group__node_1ga538588a1e2ea805377a90ac22ee6bc82" kindref="member">DPS_StartNode()</ref>. In this instance we bind the node to all available interfaces at the port provided. A port value of zero lets DPS assign an ephemeral listening port. A value of non-zero requests a specific port.</para><para>The last thing we do is get the port DPS has chosen with <ref refid="group__node_1ga32b12f0e54f0cd66b46f2a47378c6aeb" kindref="member">DPS_GetListenAddress()</ref>. This will be used by the subscriber and publisher to link to the forwarding node.</para></sect1>
<sect1 id="tutorials-link_1linking">
<title>Linking to a node</title>
<para><programlisting filename="tutorial.c"><codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>addrText[24];</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snprintf(addrText,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(addrText),<sp/></highlight><highlight class="stringliteral">&quot;127.0.0.1:%d&quot;</highlight><highlight class="normal">,<sp/>linkPort);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ret<sp/>=<sp/><ref refid="group__node_1gab7616642a79f637aa146b3b1a4ed0af8" kindref="member">DPS_Link</ref>(node,<sp/>addrText,<sp/>LinkComplete,<sp/>NULL);</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ret<sp/>!=<sp/><ref refid="group__status_1ga0ea3dd37bc558859ae0cb5a4f79a4bdd" kindref="member">DPS_OK</ref>)<sp/>{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">goto</highlight><highlight class="normal"><sp/>Exit;</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
</programlisting> Now that we know the host (<computeroutput>localhost</computeroutput> in this example) and listening port of the forwarding node, we can call <ref refid="group__node_1gab7616642a79f637aa146b3b1a4ed0af8" kindref="member">DPS_Link()</ref> to create the link from the subscriber and publisher to the forwarding node.</para><para><programlisting filename="tutorial.c"><codeline><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>LinkComplete(<ref refid="group__node_1ga4dd612ab965134321bb57fdb065f121c" kindref="member">DPS_Node</ref>*<sp/>node,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="group__nodeaddress_1ga9e9f56aa38e82b4edcef7eb81e9f5bd2" kindref="member">DPS_NodeAddress</ref>*<sp/>addr,<sp/><ref refid="group__status_1ga30395a84d3cad9d4ec29848106415038" kindref="member">DPS_Status</ref><sp/>status,<sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal">*<sp/>data)</highlight></codeline>
<codeline><highlight class="normal">{</highlight></codeline>
<codeline><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="group__debug_1gaf1d25cc7f1d2d92f96ba620217af28fd" kindref="member">DPS_PRINT</ref>(</highlight><highlight class="stringliteral">&quot;Node<sp/>is<sp/>linked<sp/>to<sp/>%s\n&quot;</highlight><highlight class="normal">,<sp/><ref refid="group__nodeaddress_1gafc7b21048f92370ca29325d6245b576d" kindref="member">DPS_NodeAddrToString</ref>(addr));</highlight></codeline>
<codeline><highlight class="normal">}</highlight></codeline>
</programlisting> The link is now complete and we can proceed with <ref refid="tutorials-hello-world_1receiving-a-publication" kindref="member">subscribing </ref> or <ref refid="tutorials-hello-world_1sending-a-publication" kindref="member">publishing </ref> as before.</para><para><simplesect kind="note"><para>The link complete callback is dispatched from the <computeroutput>DPS_Node&apos;s</computeroutput> thread.</para></simplesect>
<simplesect kind="see"><para><ref refid="group__node_1ga18398ef1e81c5dba98a95da6d18b937e" kindref="member">DPS_Unlink()</ref>, <ref refid="group__node_1ga69325fd8127687c469e503763a29f6d8" kindref="member">DPS_LinkTo()</ref>, <ref refid="group__node_1gae16f5ff85ac57a6f5567db73343c8af1" kindref="member">DPS_UnlinkFrom()</ref> </para></simplesect>
</para></sect1>
    </detaileddescription>
  </compounddef>
</doxygen>
